<link rel="import" href="/bower_components/polymer/polymer-element.html">

<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">


<link rel="import" href="/bower_components/paper-dialog/paper-dialog.html">

<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">

<link rel="import" href="/bower_components/vaadin-dropdown-menu/theme/lumo/vaadin-dropdown-menu.html">
<link rel="import" href="/bower_components/vaadin-item/theme/lumo/vaadin-item.html">
<link rel="import" href="/bower_components/vaadin-list-box/theme/lumo/vaadin-list-box.html">
<link rel="import" href="/bower_components/vaadin-text-field/theme/lumo/vaadin-text-field.html">


<link rel="import" href="./../aspen-dialog/aspen-dialog-mixin.html">


<dom-module id="aspen-account-creation-dialog">
    <template>
        <style>
            :host {
                display: block;
            }

            h2 {
                font-size: 1.2em;
                color: var(--app-header-color);
            }

            #content-panel {
                @apply --layout-vertical;
                overflow-y: scroll;
            }

            paper-dialog {
                border: 1px solid white;
                border-radius: 5px;
                width: fit-content;
                padding: 5px;
                @apply --layout-vertical;
            }
        </style>



        <paper-dialog modal>

            <h2>Create Account</h2>
            <div id="content-panel">
                <vaadin-text-field label="First Name" value="{{model.firstName}}" required autofocus
                    error-message="Please enter your first name"></vaadin-text-field>
                <vaadin-text-field label="Last Name" value="{{model.lastName}}" required
                    error-message="Please enter your last name"></vaadin-text-field>
                <vaadin-text-field label="Title" value="{{model.title}}" required
                    error-message="Please enter your title"></vaadin-text-field>
                <vaadin-text-field label="Company" value="{{model.company}}" required
                    error-message="Please enter the name of your company"></vaadin-text-field>
                <vaadin-text-field label="Email" value="{{model.email}}" required
                    error-message="Please enter your Email address"></vaadin-text-field>
                <vaadin-text-field label="Twitter" value="{{model.twitter}}" placeholder="@MyTwitterHandle" required
                    autofocus error-message="Please enter your Twitter handle"></vaadin-text-field>

            </div>
            <div class="buttons">
                <paper-button dialog-dismiss>Cancel</paper-button>
                <paper-button autofocus on-tap="__createAccount">Accept</paper-button>
            </div>


        </paper-dialog>




    </template>

    <script>
        /**
         * `aspen-account-creation-dialog` This dialog displays the account creation information.
         *
         * @summary ShortDescription.
         * @customElement
         * @polymer
         * @extends {Polymer.Element}
         */
        class AspAccountCreationDialog extends AspDialogMixin(Polymer.Element) {
            /**
             * String providing the tag name to register the element under.
             */
            static get is() {
                return 'aspen-account-creation-dialog';
            }

            static get properties() {
                return {

                    /** The UID of the user. */
                    uid: {
                        type: String,
                        value: '',
                        notify: true
                    }
                }
            }


            /**
             * Instance of the element is created/upgraded. Use: initializing state,
             * set up event listeners, create shadow dom.
             * @constructor
             */
            constructor() {
                super();
            }

            /**
             * Use for one-time configuration of your component after local DOM is initialized. 
             */
            ready() {
                super.ready();

                Polymer.RenderStatus.afterNextRender(this, function () {

                });
            }

            show(e) {
                this.model = e.detail.user;

                let dialog = this.shadowRoot.querySelector("paper-dialog");
                dialog.open();
            }

            /**
             * This method triggers an event used to create the user's account.
             */
            __createAccount(e) {

                let invalid = false;
                let fldArray = this.shadowRoot.querySelectorAll("vaadin-text-field");
                for (let fld of fldArray) {
                    if (!fld.validate()) {
                        invalid = true
                        break;
                    }
                }
                if (!invalid) {

                    let dialog = this.shadowRoot.querySelector("paper-dialog");
                    dialog.close();

                    this.model.inDemoMode = true;

                    this.dispatchEvent(new CustomEvent('create-account', {
                        bubbles: true,
                        composed: true,
                        detail: {
                            user: this.model,
                            uid: this.uid
                        }
                    }));


                }
            }

        }

        window.customElements.define(AspAccountCreationDialog.is, AspAccountCreationDialog);
    </script>
</dom-module>